<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 100px;
    }
    input {
      margin: 5px;
      padding: 8px;
      width: 200px;
    }
    button {
      padding: 8px 16px;
      margin-top: 10px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
</head>
<body>
  <h2>üîê Chat Login</h2>
  <input type="text" id="username" placeholder="Username"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>

  <script>
    const backend = 'https://chat-backend-pdzh.onrender.com';

    async function login() {
      const username = document.getElementById('username').value.trim();
      const password = md5(document.getElementById('password').value.trim());

      if (!username || !password) {
        alert('Please enter both username and password.');
        return;
      }

      const res = await fetch(`${backend}/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const result = await res.json();

      if (result.success) {
        localStorage.setItem('chatUser', username);
        localStorage.setItem('isAdmin', result.isAdmin);
        if (result.redirect) {
          location.href = result.redirect;
        } else {
          location.href = 'chat.html';
        }
      } else {
        alert('‚ùå Invalid username or password.');
      }
    }
  </script>
</body>
</html>


      if (!username || !password) return alert('Please enter both fields.');

      const res = await fetch(`${backend}/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const result = await res.json();

      if (result.success) {
        localStorage.setItem('chatUser', username);
        localStorage.setItem('isAdmin', result.isAdmin);
        if (result.redirect) return location.href = result.redirect;
        location.href = 'chat.html';
      } else {
        alert('‚ùå Invalid username or password.');
      }
    }

    // Optional: check if chat is off before login
    setInterval(async () => {
      const res = await fetch(`${backend}/status`);
      const status = await res.json();
      if (status.off) document.body.innerHTML = '<h2>üöß Chat is currently offline</h2><p>Please try again later.</p>';
    }, 5000);
  </script>
</body>
</html>
