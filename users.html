<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>All Users</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .user-list { display: flex; flex-wrap: wrap; gap: 20px; }
    .user-card {
      width: 180px;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
    }
    .user-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 8px;
    }
    .username { font-weight: bold; margin-bottom: 4px; }
    .ranks { font-size: 0.9em; color: #555; margin-bottom: 8px; }
    .online { color: green; font-size: 0.85em; margin-bottom: 8px; }
    .offline { color: gray; font-size: 0.85em; margin-bottom: 8px; }
    .admin-btn { margin-top: 6px; padding: 4px 8px; cursor: pointer; }
    #controls { margin-top: 30px; text-align: center; }
    #refresh { padding: 8px 16px; }
  </style>
</head>
<body>
  <h1>All Users</h1>
  <div class="user-list" id="userList">Loading…</div>
  <div id="controls">
    <button id="refresh">Refresh</button>
  </div>

  <script>
    const API     = 'https://chat-backend-pdzh.onrender.com';
    const isAdmin = localStorage.getItem('isAdmin') === 'true';

    async function loadUsers() {
      const listEl = document.getElementById('userList');
      listEl.innerHTML = 'Loading…';

      // fetch user data + ranks
      const [ users, ranks ] = await Promise.all([
        fetch(`${API}/users`).then(r => r.json()),
        fetch(`${API}/ranks.json`).then(r => r.json())
      ]);

      listEl.innerHTML = '';
      users.forEach(u => {
        const card = document.createElement('div');
        card.className = 'user-card';

        // profile pic (local placeholder.png or remote asset)
        const img = document.createElement('img');
        img.src = u.profilePic === 'placeholder.png'
          ? 'placeholder.png'
          : `${API}/assets/${u.profilePic}`;
        card.appendChild(img);

        // username
        const nameDiv = document.createElement('div');
        nameDiv.className = 'username';
        nameDiv.innerText = u.username;
        card.appendChild(nameDiv);

        // ranks (from /ranks.json)
        const userRanks = ranks[u.username] || [];
        const ranksDiv = document.createElement('div');
        ranksDiv.className = 'ranks';
        ranksDiv.innerText = userRanks.length
          ? `Ranks: ${userRanks.join(', ')}`
          : 'Ranks: none';
        card.appendChild(ranksDiv);

        // online/offline
        const statusDiv = document.createElement('div');
        statusDiv.className = u.online ? 'online' : 'offline';
        statusDiv.innerText = u.online ? 'Online' : 'Offline';
        card.appendChild(statusDiv);

        // admin ban/unban
        if (isAdmin) {
          const btn = document.createElement('button');
          btn.className = 'admin-btn';
          btn.innerText = u.banned ? 'Unban' : 'Ban';
          btn.onclick = async () => {
            const action = u.banned ? 'unban' : 'ban';
            await fetch(`${API}/${action}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ user: u.username })
            });
            loadUsers();
          };
          card.appendChild(btn);
        }

        listEl.appendChild(card);
      });
    }

    document.getElementById('refresh').onclick = loadUsers;
    loadUsers();
  </script>
</body>
</html>
